<!DOCTYPE html>
<html>
<head>
	  <!-- Standard Meta -->
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">

	<title>배고프다 - 메뉴 결정 도우미</title>

	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.css">
	<link href='https://cdn.rawgit.com/openhiun/hangul/14c0f6faa2941116bb53001d6a7dcd5e82300c3f/nanumbarungothic.css' rel='stylesheet' type='text/css'>
	<style>
		.step.page {
			display: none;
			padding-top: 1em;
		}
		#header .ui.text.container {
			padding-top: 2rem;
			padding-bottom: 2rem;
		}
		#footer {
	    display: block;
	    position: absolute;
	    width: 100%;
	    bottom: 0;
		}
		#footer .ui.text.container {
			text-align: center;
			font-size: 1rem;
		}
		@media all and (max-width: 768px) {
      #header .ui.text.container { 
				padding-top: 0rem;
				padding-bottom: 0rem;
			}
		}
	</style>

	<script
	  src="https://code.jquery.com/jquery-3.1.1.min.js"
	  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
	  crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.js"></script>
</head>
<body>
	<div class="ui inverted vertical masthead center aligned segment" id="header">
		<div class="ui text container">
			<h1 class="ui inverted header" style="margin: 0;">
				메뉴 결정 도우미 &nbsp;<a href="#" class="ui basic label">v0.2</a>
			</h1>
		</div>
	</div>
	<div class="ui vertical segment" style="padding-bottom: 10rem;">
		<div class="ui container" style="text-align: center; margin: 2em auto;">
			<button class="ui huge primary button" id="buttonStart">도와줘요!</button>
			<div id="page1" class="step page"></div>
			<div id="page2" class="step page"></div>
		</div>
	</div>

	<div class="ui black inverted vertical footer segment" id="footer">
		<div class="ui text container">
			<p
				id="supportedBrowsers"
				data-tooltip="Edge 15+, Firefox 56+, Chrome 61+, Safari 10.1+">
				이 사이트를 정상적으로 사용하시려면 비동기 속성을 지원하는 브라우저가 필요합니다.<br>
				<a href="https://caniuse.com/#search=async" target="_blank">이 곳</a>에서 지원 가능한 브라우저를 확인하세요.
			</p>
			<p>2017년 12월까지 73.32%의 브라우저가 <a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Statements/async_function" target="_blank">이 기능</a>을 지원하고 있습니다.</p>
		</div>
	</div>
</body>

<script async="true" type="text/javascript">
	$(document).ready(function(){
		$("#supportedBrowsers").popup();

		function sleep(ms) {
		  return new Promise(function(resolve){return setTimeout(resolve, ms)});
		}

		async function doRoulette(funcs, curr, len, speed, endtime){
			if(speed >= endtime){
				funcs.onDone();
				return;
			}
	  	await sleep(speed);
	  	funcs.onRun((curr + len -1) % len, curr % len);
	  	doRoulette(funcs, curr+1, len, speed + (speed / 20.), endtime);
		}

		function init(){
			var pages = $(".step.page");
			pages.removeClass('transition visible');
			pages.attr('style', '');
			$('.ui.label').removeClass('basic huge selected yellow blue');
		}

		function reset(){
			init();
			$("#buttonStart").removeClass('disabled loading');
		}


		var randomSpeedMin = 100, randomSpeedMax = 500;

		var runRoulettePage = function (menuId, menuset){
			var menuset = menuset || {};
			var div = $("#page" + menuId);
			if( ! Object.keys(menuset).length ){
				$("#buttonStart").removeClass('disabled loading');
				div.removeClass('running');
				return false;
			}
					
			var menuStr = 'menu' + menuId;
			div.html('');
			Object.keys(menuset).forEach(function(m, idx){
				var item = '<div class="ui label ' + menuStr + '" id="'+ menuStr +'-'+ idx +'">'+ m +'</div>';
				div.append(item);
			});

			return {
				animation : 'slide down',
				onStart: function(){
					if( div.hasClass('running') ) return;
					div.addClass('running');
				},
				onComplete: function(){
					if( !div.hasClass('running') ) return;

					var endtime = Math.random() * (randomSpeedMax - randomSpeedMin) + randomSpeedMin;
					var incTime = Math.min(20, Math.max(50, Math.random()));
					doRoulette({
						onRun: function(prev, curr){
							$('#' + menuStr + '-' + prev).removeClass('huge yellow selected');
							$('#' + menuStr + '-' + curr).addClass('huge yellow selected');
						},
						onDone: function(){
							var selected = $('.' + menuStr +'.selected');
							selected.addClass('basic blue');
							selected.removeClass('yellow');
							var nextId = menuId + 1;
							$("#page" + nextId).transition(
								runRoulettePage(nextId, menuset[selected.html()])
							);
						}
					},
						0, Object.keys(menuset).length, incTime, endtime
					);
				}
			};
		};

		function startRoullette(menus){
			$("#page1").transition(runRoulettePage(1, menus));
		}

		$("#buttonStart").on('click', function(evt){
  		var e = evt || window.event;
	    //IE9 & Other Browsers
	    if (e.stopPropagation) { e.stopPropagation(); }
	    //IE8 and Lower
	    else { e.cancelBubble = true; }
			e.preventDefault();

			init();
			$("#buttonStart").addClass('disabled loading');
			$.getJSON("./menus.json", startRoullette);
		});
	});
</script>
</html>
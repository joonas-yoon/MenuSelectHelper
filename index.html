<!DOCTYPE html>
<html>
<head>
	  <!-- Standard Meta -->
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">

	<title>배고프다 - 메뉴 결정 도우미</title>

	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.css">
	<link href='https://cdn.rawgit.com/openhiun/hangul/14c0f6faa2941116bb53001d6a7dcd5e82300c3f/nanumbarungothic.css' rel='stylesheet' type='text/css'>
	<style>
		.step.page {
			display: none;
			padding-top: 1em;
		}
	</style>

	<script
	  src="https://code.jquery.com/jquery-3.1.1.min.js"
	  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
	  crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.js"></script>
</head>
<body>
	<div class="ui inverted vertical masthead center aligned segment">
		<div class="ui text container">
			<h1 class="ui inverted header" style="margin-top: 2em; margin-bottom: 0.5em;">
				메뉴 결정 도우미
			</h1>
			<a href="#" class="ui basic label">v0.1</a>
			<div style="display:block; height: 2em; line-height: 2em;">&nbsp;</div>
		</div>
	</div>
	<div class="ui vertical segment">
		<div class="ui container" style="text-align: center; margin: 2em auto;">
			<button class="ui huge primary button" id="buttonStart">도와줘요!</button>
			<div id="page1" class="step page"></div>
			<div id="page2" class="step page"></div>
		</div>
	</div>
</body>

<script>
	function sleep(ms) {
	  return new Promise(resolve => setTimeout(resolve, ms));
	}

	async function doRoulette(funcs, curr, len, speed, endtime){
		if(speed >= endtime){
			funcs.onDone();
			return;
		}
  	await sleep(speed);
  	funcs.onRun((curr + len -1) % len, curr % len);
  	doRoulette(funcs, curr+1, len, speed + (speed / 20.), endtime);
	}

	$(function(){

		function init(){
			$(".step.page").transition('hide');
			$("#buttonStart").removeClass('disabled loading');
		}

		var menus = {
			'중식':{
				'탕수육': {},
				'깐풍기': {},
				'칠리새우': {},
				'짬뽕': {},
				'사천탕수육': {},
				'짜짱면': {},
				'유린기': {},
				'울면': {}
			},
			'일식': {
				'초밥': {},
				'돈부리': {},
				'회': {},
				'소바': {},
				'오코노미야끼': {},
				'라멘': {},
				'정어덮밥': {},
				'우동': {}
			},
			'한식': {
				'냉면': {},
				'설렁탕': {},
				'닭도리탕': {},
				'간장게장': {},
				'김치찌개': {},
				'낙지': {},
				'불고기': {},
				'곱창': {}
			},
			'고기': {
				'삼겹살': {},
				'갈비': {},
				'갈매기살': {},
				'항정살': {},
				'목살': {},
				'가브리살': {},
				'등심': {},
				'안심': {}
			},
			'라면': {
				'비빔면': {},
				'신라면': {},
				'짜왕': {},
				'너구리': {},
				'불닭볶음면': {},
				'삼양라면': {},
				'진라면': {},
				'안성탕면': {}
			},
			'치킨': {
				'BBQ': {},
				'BHC': {},
				'네네치킨': {},
				'굽네치킨': {},
				'교촌치킨': {},
				'KFC': {},
				'파파이스': {},
				'맘스터치': {}
			},
			'분식/야식/디저트': {
				'떡볶이': {},
				'순대': {},
				'빙수': {},
				'오뎅': {},
				'보쌈': {},
				'족발': {},
				'케이크': {},
				'빵': {},
				'푸딩': {}
			},
			'기타': {
				'스테이크': {},
				'파스타': {},
				'훈제오리': {},
				'햄버거': {},
				'쌀국수': {},
				'피자': {},
				'만두': {},
				'커리': {}
			}
		};

		var pageConfig1 = function(menuset){
			return {
				animation: 'slide down',
				onShow: function(){
					var div = $(this);
					if( div.hasClass('running') ) return;
					div.html('');
					Object.keys(menuset).forEach(function(m, idx){
						div.append('<div class="ui label menu1" id="menu1-'+ idx +'">'+ m +'</div>');
					});
				},
				onComplete: function(){
					var div = $(this);
					if( div.hasClass('running') ) return;

					div.addClass('running');
					var endtime = Math.random() * 750 + 200;
					var incTime = Math.min(20, Math.max(50, Math.random()));
					doRoulette({
						onRun: function(prev, curr){
							$("#menu1-"+prev).removeClass('huge yellow selected');
							$("#menu1-"+curr).addClass('huge yellow selected');
						},
						onDone: function(){
							div.removeClass('running');
							$("#page2").transition(pageConfig2(menuset[$('.menu1.selected').html()]));
						}
					},
						0, 8, incTime, endtime
					);
				}
			};
		};

		var pageConfig2 = function(menuset){
			return {
				animation : 'slide down',
				onStart: function(){
					var div = $(this);
					div.html('');
					Object.keys(menuset).forEach(function(m, idx){
						div.append('<div class="ui label menu2" id="menu2-'+ idx +'">'+ m +'</div>');
					});
				},
				onComplete: function(){
					var endtime = Math.random() * 750 + 200;
					var incTime = Math.min(20, Math.max(50, Math.random()));
					console.log(endtime);
					doRoulette({
						onRun: function(prev, curr){
							$("#menu2-"+prev).removeClass('huge yellow selected');
							$("#menu2-"+curr).addClass('huge yellow selected');
						},
						onDone: function(){

							$("#buttonStart").removeClass('disabled loading');
							// $("#page3").transition(pageConfig2);
						}
					},
						0, Object.keys(menuset).length, incTime, endtime
					);
				}
			};
		};

		$("#buttonStart").click(function(){
			$("#buttonStart").addClass('disabled loading');
			$("#page1").transition(pageConfig1(menus));
		});
	});
</script>
</html>
